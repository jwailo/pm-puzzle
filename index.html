<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>The PM Puzzle</title>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2W2V6EYFGQ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-2W2V6EYFGQ');
    </script>

    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Clear+Sans:wght@400;700&display=swap" rel="stylesheet">

    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta name="referrer" content="strict-origin-when-cross-origin">

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Security Initialization (loads before main scripts) -->
    <script src="/secure-init.js"></script>
    <script src="/utils/auth-security.js"></script>
</head>
<body>
    <div class="game-container">
        <!-- Header -->
        <header class="header">
            <div class="header-icons">
                <div class="menu-left">
                    <button id="menu-btn" class="icon-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                        </svg>
                    </button>
                </div>
                <div class="menu-right">
                    <button id="help-btn" class="icon-btn">?</button>
                    <button id="stats-btn" class="icon-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <rect x="3" y="12" width="4" height="9" rx="1"/>
                            <rect x="10" y="8" width="4" height="13" rx="1"/>
                            <rect x="17" y="4" width="4" height="17" rx="1"/>
                        </svg>
                    </button>
                    <button id="settings-btn" class="icon-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5a3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97c0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1c0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/>
                        </svg>
                    </button>
                    <!-- User Account Dropdown -->
                    <div id="user-dropdown" class="user-dropdown hidden">
                        <button id="user-btn" class="user-btn">
                            <span id="user-initial">?</span>
                        </button>
                        <div id="user-menu" class="user-menu">
                            <div class="user-menu-header">
                                <div id="user-menu-name" class="user-menu-name">User Name</div>
                                <div id="user-menu-email" class="user-menu-email">user@email.com</div>
                            </div>
                            <button id="user-logout-btn" class="user-menu-item logout">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="title">
                <div class="brand-text">Ailo presents</div>
                <h1>The PM Puzzle</h1>
                <div class="subtitle">...because PMs deserve a break</div>
            </div>
        </header>

        <!-- Auth Section -->
        <div id="auth-section" class="auth-section">
            <div id="auth-form" class="auth-form">
                <h2 id="auth-title">Sign In</h2>
                <form id="login-form" autocomplete="off">
                    <input type="text" id="firstname" placeholder="First Name" autocomplete="given-name">
                    <input type="email" id="email" placeholder="Email Address" required autocomplete="email">
                    <input type="password" id="password" placeholder="Password" required autocomplete="current-password">
                    <div id="password-requirements" class="password-requirements hidden">
                        <small>Password must contain:</small>
                        <ul class="requirements-list">
                            <li id="req-length" class="requirement">At least 8 characters</li>
                            <li id="req-uppercase" class="requirement">Uppercase letter (A-Z)</li>
                            <li id="req-lowercase" class="requirement">Lowercase letter (a-z)</li>
                            <li id="req-number" class="requirement">Number (0-9)</li>
                            <li id="req-special" class="requirement">Special character (!@#$%^&*)</li>
                        </ul>
                    </div>
                    <div id="marketing-consent" class="marketing-consent hidden">
                        <label class="checkbox-label">
                            <input type="checkbox" id="marketing-checkbox" checked required>
                            <span class="checkmark"></span>
                            I consent to receive marketing materials from Ailo (required)
                        </label>
                    </div>
                    <div id="reminder-consent" class="reminder-consent hidden">
                        <label class="checkbox-label">
                            <input type="checkbox" id="reminder-checkbox">
                            <span class="checkmark"></span>
                            Want a daily reminder each time a new word is available?
                        </label>
                    </div>
                    <div id="terms-agreement" class="terms-agreement hidden">
                        <small>By signing up, you agree to our <a href="terms.html" target="_blank">Competition Terms & Conditions</a></small>
                    </div>
                    <button type="submit" id="auth-submit">Sign In</button>
                </form>
                <div class="mecca-voucher">
                    $50 MECCA voucher given to a player daily
                </div>
                <div class="auth-switch">
                    <span id="auth-switch-text">Don't have an account?</span>
                    <button type="button" id="auth-toggle">Sign Up</button>
                </div>
                <div id="forgot-password-section" class="forgot-password-section">
                    <button type="button" id="forgot-password-btn" class="link-btn">Forgot password?</button>
                </div>
                <button type="button" id="skip-auth" class="skip-btn">Skip & Play as Guest</button>
            </div>
        </div>

        <!-- Forgot Password Modal -->
        <div id="forgot-password-modal" class="modal">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h2>Reset Password</h2>
                    <button class="close-btn" id="forgot-close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Enter your email address and we'll send you a link to reset your password.</p>
                    <form id="forgot-password-form">
                        <input type="email" id="forgot-email" placeholder="Email Address" required style="width: 100%; margin-bottom: 16px; padding: 12px; border: 2px solid var(--color-border); border-radius: 4px; font-size: 14px;">
                        <button type="submit" id="forgot-submit" style="width: 100%; padding: 12px; background-color: var(--color-primary); color: white; border: none; border-radius: 4px; font-size: 14px; font-weight: 600; cursor: pointer;">Send Reset Link</button>
                    </form>
                    <div id="forgot-message" style="margin-top: 16px; text-align: center; font-size: 14px;"></div>
                </div>
            </div>
        </div>

        <!-- Game Board -->
        <div class="game-board">
            <div class="board-container">
                <div class="board" id="board">
                    <!-- 6 rows of 5 tiles each -->
                    <div class="row">
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                    </div>
                    <div class="row">
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                    </div>
                    <div class="row">
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                    </div>
                    <div class="row">
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                    </div>
                    <div class="row">
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                    </div>
                    <div class="row">
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                        <div class="tile"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Keyboard -->
        <div class="keyboard">
            <div class="keyboard-row">
                <button class="key" data-key="Q">Q</button>
                <button class="key" data-key="W">W</button>
                <button class="key" data-key="E">E</button>
                <button class="key" data-key="R">R</button>
                <button class="key" data-key="T">T</button>
                <button class="key" data-key="Y">Y</button>
                <button class="key" data-key="U">U</button>
                <button class="key" data-key="I">I</button>
                <button class="key" data-key="O">O</button>
                <button class="key" data-key="P">P</button>
            </div>
            <div class="keyboard-row">
                <button class="key" data-key="A">A</button>
                <button class="key" data-key="S">S</button>
                <button class="key" data-key="D">D</button>
                <button class="key" data-key="F">F</button>
                <button class="key" data-key="G">G</button>
                <button class="key" data-key="H">H</button>
                <button class="key" data-key="J">J</button>
                <button class="key" data-key="K">K</button>
                <button class="key" data-key="L">L</button>
            </div>
            <div class="keyboard-row">
                <button class="key key-large" data-key="Enter">ENTER</button>
                <button class="key" data-key="Z">Z</button>
                <button class="key" data-key="X">X</button>
                <button class="key" data-key="C">C</button>
                <button class="key" data-key="V">V</button>
                <button class="key" data-key="B">B</button>
                <button class="key" data-key="N">N</button>
                <button class="key" data-key="M">M</button>
                <button class="key key-large" data-key="Backspace">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M22 3H7c-.69 0-1.23.35-1.59.88L.88 11.88c-.43.65-.43 1.59 0 2.24l4.53 8c.36.53.9.88 1.59.88H22c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H7.07L3 12l4.07-7H22v14zm-11.59-2L14 13.41 17.59 17 19 15.59 15.41 12 19 8.41 17.59 7 14 10.59 10.41 7 9 8.41 12.59 12 9 15.59z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Messages -->
        <div id="message-container" class="message-container"></div>
    </div>

    <!-- Modals -->
    <!-- Help Modal -->
    <div id="help-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>How To Play</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p>Guess the <strong>PROPERTY MANAGEMENT WORD</strong> in 6 tries.</p>
                <ul>
                    <li>Each guess must be a valid 5-letter word. Hit the enter button to submit.</li>
                    <li>After each guess, the color of the tiles will change to show how close your guess was to the word.</li>
                </ul>
                <div class="examples">
                    <h3>Examples</h3>
                    <div class="example">
                        <div class="example-row">
                            <div class="example-tile correct">L</div>
                            <div class="example-tile">E</div>
                            <div class="example-tile">A</div>
                            <div class="example-tile">S</div>
                            <div class="example-tile">E</div>
                        </div>
                        <p>The letter <strong>L</strong> is in the word and in the correct spot.</p>
                    </div>
                    <div class="example">
                        <div class="example-row">
                            <div class="example-tile">R</div>
                            <div class="example-tile present">E</div>
                            <div class="example-tile">N</div>
                            <div class="example-tile">T</div>
                            <div class="example-tile">S</div>
                        </div>
                        <p>The letter <strong>E</strong> is in the word but in the wrong spot.</p>
                    </div>
                    <div class="example">
                        <div class="example-row">
                            <div class="example-tile">T</div>
                            <div class="example-tile">O</div>
                            <div class="example-tile">W</div>
                            <div class="example-tile absent">E</div>
                            <div class="example-tile">R</div>
                        </div>
                        <p>The letter <strong>E</strong> is not in the word in any spot.</p>
                    </div>
                </div>
                <p><strong>A new PROPERTY MANAGEMENT WORD will be available each day at 12:00 PM!</strong></p>
            </div>
        </div>
    </div>

    <!-- Stats Modal -->
    <div id="stats-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Statistics</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stats-grid">
                    <div class="stat">
                        <div class="stat-number" id="games-played">0</div>
                        <div class="stat-label">Played</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="win-percentage">0</div>
                        <div class="stat-label">Win %</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="current-streak">0</div>
                        <div class="stat-label">Current Streak</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="max-streak">0</div>
                        <div class="stat-label">Max Streak</div>
                    </div>
                </div>
                <div style="margin: 12px 0; padding: 10px; background: #f0f8ff; border-radius: 6px; border-left: 3px solid #4299e1;">
                    <p style="margin: 0; font-size: 12px; color: #2c5282; line-height: 1.5;">
                        <strong>📅 Weekday Streak:</strong> Your streak only requires playing on weekdays (Mon-Fri).
                        Weekends are optional - skip them without losing your streak!
                    </p>
                </div>
                <div class="guess-distribution">
                    <h3>Guess Distribution</h3>
                    <div class="distribution-grid">
                        <div class="distribution-row">
                            <span>1</span>
                            <div class="distribution-bar">
                                <div class="distribution-fill" id="dist-1"></div>
                                <span class="distribution-count" id="count-1">0</span>
                            </div>
                        </div>
                        <div class="distribution-row">
                            <span>2</span>
                            <div class="distribution-bar">
                                <div class="distribution-fill" id="dist-2"></div>
                                <span class="distribution-count" id="count-2">0</span>
                            </div>
                        </div>
                        <div class="distribution-row">
                            <span>3</span>
                            <div class="distribution-bar">
                                <div class="distribution-fill" id="dist-3"></div>
                                <span class="distribution-count" id="count-3">0</span>
                            </div>
                        </div>
                        <div class="distribution-row">
                            <span>4</span>
                            <div class="distribution-bar">
                                <div class="distribution-fill" id="dist-4"></div>
                                <span class="distribution-count" id="count-4">0</span>
                            </div>
                        </div>
                        <div class="distribution-row">
                            <span>5</span>
                            <div class="distribution-bar">
                                <div class="distribution-fill" id="dist-5"></div>
                                <span class="distribution-count" id="count-5">0</span>
                            </div>
                        </div>
                        <div class="distribution-row">
                            <span>6</span>
                            <div class="distribution-bar">
                                <div class="distribution-fill" id="dist-6"></div>
                                <span class="distribution-count" id="count-6">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="leaderboards" id="leaderboards-section">
                    <h3>Leaderboards</h3>
                    <div class="leaderboard-tabs">
                        <button class="tab-btn active" data-tab="daily">Today's Fastest</button>
                        <button class="tab-btn" data-tab="streak">Longest Streaks</button>
                    </div>
                    <div class="leaderboard-content">
                        <div id="daily-leaderboard" class="leaderboard active">
                            <div class="leaderboard-list" id="daily-list">
                                <div class="leaderboard-empty">No times recorded yet today</div>
                            </div>
                        </div>
                        <div id="streak-leaderboard" class="leaderboard">
                            <div class="leaderboard-list" id="streak-list">
                                <div class="leaderboard-empty">No streaks recorded yet</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="share-section">
                    <button id="share-btn" class="share-btn">Share</button>
                    <div class="countdown">
                        <span>Next puzzle (12:00 PM): </span>
                        <span id="countdown-timer">--:--:--</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Menu Modal -->
    <div id="menu-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Menu</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="menu-options">
                    <button id="menu-logout" class="menu-option-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                        </svg>
                        <span>Log Out</span>
                    </button>
                    <button id="menu-share" class="menu-option-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
                        </svg>
                        <span>Share Game</span>
                    </button>
                    <a href="https://www.ailo.io" target="_blank" class="menu-option-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"/>
                        </svg>
                        <span>What is Ailo?</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-row">
                    <div class="setting-info">
                        <div class="setting-title">Hard Mode</div>
                        <div class="setting-description">Any revealed hints must be used in subsequent guesses</div>
                    </div>
                    <div class="setting-toggle">
                        <input type="checkbox" id="hard-mode-toggle">
                        <label for="hard-mode-toggle" class="toggle-label"></label>
                    </div>
                </div>
                <div class="setting-row">
                    <div class="setting-info">
                        <div class="setting-title">Dark Theme</div>
                        <div class="setting-description">Switch to dark mode</div>
                    </div>
                    <div class="setting-toggle">
                        <input type="checkbox" id="dark-theme-toggle">
                        <label for="dark-theme-toggle" class="toggle-label"></label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Instructions Modal -->
    <div id="share-instructions-modal" class="modal">
        <div class="modal-content share-modal-content">
            <div class="modal-header">
                <h2>Share Your Results</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body share-modal-body">
                <div class="share-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="var(--color-ailo-pink)">
                        <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
                    </svg>
                </div>
                <p class="share-instructions">
                    Take a screenshot of your results and share on social media
                </p>
                <div class="share-hashtag">#PMPuzzle #AiloPM</div>
                <button id="share-got-it" class="share-btn">Got it!</button>
            </div>
        </div>
    </div>

    <!-- Testing Modal -->

    <!-- Post-Game Statistics Modal -->
    <div id="post-game-stats-modal" class="modal">
        <div class="modal-content post-game-modal-content">
            <div class="modal-header">
                <h2 id="post-game-title">🎉 Congratulations!</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body post-game-modal-body">
                <div class="completion-summary">
                    <div class="completion-stats">
                        <div class="completion-stat">
                            <div class="completion-number" id="completion-guesses">3</div>
                            <div class="completion-label">Guesses</div>
                        </div>
                        <div class="completion-stat">
                            <div class="completion-number" id="completion-time">1m 23s</div>
                            <div class="completion-label">Time</div>
                        </div>
                        <div class="completion-stat">
                            <div class="completion-number" id="completion-streak">5</div>
                            <div class="completion-label">Streak</div>
                        </div>
                    </div>
                </div>
                
                <div class="personal-stats-preview">
                    <h3>Your Overall Stats</h3>
                    <div class="mini-stats-grid">
                        <div class="mini-stat">
                            <div class="mini-stat-number" id="mini-games-played">0</div>
                            <div class="mini-stat-label">Played</div>
                        </div>
                        <div class="mini-stat">
                            <div class="mini-stat-number" id="mini-win-percentage">0</div>
                            <div class="mini-stat-label">Win %</div>
                        </div>
                        <div class="mini-stat">
                            <div class="mini-stat-number" id="mini-current-streak">0</div>
                            <div class="mini-stat-label">Streak</div>
                        </div>
                        <div class="mini-stat">
                            <div class="mini-stat-number" id="mini-max-streak">0</div>
                            <div class="mini-stat-label">Best</div>
                        </div>
                    </div>
                    <div style="margin: 10px 0; padding: 8px; background: #f0f8ff; border-radius: 4px;">
                        <p style="margin: 0; font-size: 11px; color: #2c5282; text-align: center;">
                            📅 <strong>Weekday Streak:</strong> Only weekdays required • Weekends optional
                        </p>
                    </div>
                </div>

                <div class="post-game-actions">
                    <button id="post-game-share" class="post-game-btn primary">Share Results</button>
                    <button id="post-game-stats" class="post-game-btn secondary">View Full Stats</button>
                    <button id="post-game-continue" class="post-game-btn secondary">Continue</button>
                </div>
            </div>
        </div>
    </div>

    <script src="config.js?v=4"></script>
    <script src="script.js?v=4"></script>
</body>
</html>